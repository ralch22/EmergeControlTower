<!DOCTYPE html>
<html lang="en" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
    <title>Emerge Digital Control Tower</title>
    <meta property="og:title" content="Emerge Digital Control Tower" />
    <meta property="og:description" content="Agency Master Dashboard" />
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
    
    <!-- Tailwind (using local for speed if available) -->
    <link rel="stylesheet" href="/src/index.css" />
    
    <!-- Dashboard function (must be before Alpine.js) -->
    <script>
      function dashboard() {
        return {
          time: '',
          currentView: 'dashboard',
          kpi: {
            mrr: '$0',
            mrrChange: '+0%',
            profit: '$0',
            aiOutput: '0'
          },
          pods: [],
          phases: [],
          queue: [],
          alerts: [],
          clients: [],
          selectedClient: '',
          isRunning: false,
          lastRunId: null,
          allContent: [],
          filteredContent: [],
          contentFilter: {
            clientId: '',
            type: '',
            status: ''
          },
          contentStats: {
            total: 0,
            pending: 0,
            approved: 0,
            avgScore: '-'
          },
          showContentModal: false,
          selectedContent: null,
          isGeneratingVideo: false,
          
          // Video Projects
          allVideoProjects: [],
          filteredVideoProjects: [],
          videoProjectFilter: {
            status: ''
          },
          videoProjectStats: {
            total: 0,
            draft: 0,
            generating: 0,
            ready: 0,
            exported: 0
          },
          showVideoProjectModal: false,
          selectedVideoProject: null,
          isGeneratingProject: false,
          isExportingProject: false,
          
          async initDashboard() {
            this.updateTime();
            setInterval(() => this.updateTime(), 1000);
            
            // Load initial data
            await this.loadData();
            
            // Refresh data every 10 seconds
            setInterval(() => this.loadData(), 10000);
          },
          
          async loadData() {
            try {
              await Promise.all([
                this.loadKpis(),
                this.loadPods(),
                this.loadPhaseChanges(),
                this.loadApprovals(),
                this.loadAlerts(),
                this.loadClients(),
                this.loadVideoProjects()
              ]);
            } catch (error) {
              console.error('Error loading data:', error);
            }
          },

          async loadKpis() {
            const response = await fetch('/api/kpis');
            const data = await response.json();
            if (data) {
              this.kpi = {
                mrr: '$' + parseFloat(data.mrr).toLocaleString('en-US', { maximumFractionDigits: 0 }),
                mrrChange: '+' + parseFloat(data.mrrChange).toFixed(1) + '%',
                profit: '$' + parseFloat(data.profitToday).toLocaleString('en-US', { maximumFractionDigits: 0 }),
                aiOutput: data.aiOutputToday.toLocaleString()
              };
            }
          },

          async loadPods() {
            const response = await fetch('/api/pods');
            const data = await response.json();
            this.pods = data.map(pod => ({
              id: pod.id,
              name: pod.name,
              vertical: pod.vertical,
              mrr: '$' + (parseFloat(pod.mrr) / 1000).toFixed(0) + 'k',
              health: pod.health,
              margin: pod.margin
            }));
          },

          async loadPhaseChanges() {
            const response = await fetch('/api/phase-changes');
            const data = await response.json();
            this.phases = data.map(phase => {
              const changeDate = new Date(phase.changeDate);
              const now = new Date();
              const daysLeft = Math.ceil((changeDate - now) / (1000 * 60 * 60 * 24));
              
              return {
                id: phase.id,
                client: phase.client,
                oldPrice: '$' + (parseFloat(phase.oldPrice) / 1000).toFixed(0) + 'k',
                newPrice: '$' + (parseFloat(phase.newPrice) / 1000).toFixed(0) + 'k',
                date: changeDate.toLocaleDateString('en-US', { month: 'short', day: '2-digit' }),
                countdown: daysLeft > 0 ? daysLeft + 'd left' : 'Today'
              };
            });
          },

          async loadApprovals() {
            const response = await fetch('/api/approvals');
            const data = await response.json();
            this.queue = data.map(item => {
              const createdAt = new Date(item.createdAt);
              const now = new Date();
              const minutesAgo = Math.floor((now - createdAt) / (1000 * 60));
              
              let timeAgo;
              if (minutesAgo < 60) {
                timeAgo = minutesAgo + 'm ago';
              } else {
                const hoursAgo = Math.floor(minutesAgo / 60);
                timeAgo = hoursAgo + 'h ago';
              }
              
              return {
                id: item.id,
                client: item.client,
                type: item.type,
                author: item.author,
                thumbnail: item.thumbnail,
                timeAgo
              };
            });
          },

          async loadAlerts() {
            const response = await fetch('/api/alerts');
            const data = await response.json();
            this.alerts = data.map(alert => ({
              id: alert.id,
              title: alert.title,
              desc: alert.description
            }));
          },
          
          updateTime() {
            // Dubai is UTC+4
            const d = new Date();
            // Get UTC time and add 4 hours
            const utc = d.getTime() + (d.getTimezoneOffset() * 60000);
            const dubaiTime = new Date(utc + (3600000 * 4));
            
            this.time = dubaiTime.toLocaleTimeString('en-US', { 
              hour: '2-digit', 
              minute: '2-digit', 
              second: '2-digit',
              hour12: true 
            });
          },

          getHealthColor(score) {
              if (score >= 95) return '#10b981'; // Green
              if (score >= 85) return '#f59e0b'; // Amber
              return '#ef4444'; // Red
          },

          async approve(id) {
             try {
               await fetch(`/api/approvals/${id}/approve`, { method: 'POST' });
               this.queue = this.queue.filter(item => item.id !== id);
             } catch (error) {
               console.error('Error approving item:', error);
             }
          },
          
          async reject(id) {
             try {
               await fetch(`/api/approvals/${id}/reject`, { method: 'POST' });
               this.queue = this.queue.filter(item => item.id !== id);
             } catch (error) {
               console.error('Error rejecting item:', error);
             }
          },

          async loadClients() {
            try {
              const response = await fetch('/api/clients');
              const data = await response.json();
              this.clients = data.map(client => ({
                id: client.id,
                name: client.name,
                industry: client.industry
              }));
            } catch (error) {
              console.error('Error loading clients:', error);
            }
          },

          async runWeekForClient() {
            if (!this.selectedClient || this.isRunning) return;
            
            this.isRunning = true;
            
            try {
              const response = await fetch('/api/content-factory/run-week', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ clientId: parseInt(this.selectedClient) })
              });
              
              const data = await response.json();
              
              if (response.ok) {
                this.lastRunId = data.runId;
                console.log('Content run started:', data.runId);
              } else {
                console.error('Failed to start content run:', data.error);
                alert('Failed to start content generation: ' + data.error);
              }
            } catch (error) {
              console.error('Error starting content run:', error);
              alert('Failed to start content generation. Please try again.');
            } finally {
              setTimeout(() => {
                this.isRunning = false;
              }, 5000);
            }
          },

          async loadContent() {
            try {
              let url = '/api/content';
              if (this.contentFilter.clientId) {
                url += `?clientId=${this.contentFilter.clientId}`;
              }
              const response = await fetch(url);
              const data = await response.json();
              this.allContent = data;
              this.filterContent();
              this.updateContentStats();
            } catch (error) {
              console.error('Error loading content:', error);
            }
          },

          filterContent() {
            this.filteredContent = this.allContent.filter(item => {
              if (this.contentFilter.type && item.type !== this.contentFilter.type) return false;
              if (this.contentFilter.status && item.status !== this.contentFilter.status) return false;
              return true;
            });
          },

          updateContentStats() {
            const total = this.allContent.length;
            const pending = this.allContent.filter(c => c.status === 'pending_review').length;
            const approved = this.allContent.filter(c => c.status === 'approved').length;
            const scores = this.allContent.filter(c => c.qaScore).map(c => c.qaScore);
            const avgScore = scores.length > 0 
              ? (scores.reduce((a, b) => a + b, 0) / scores.length).toFixed(1) 
              : '-';
            
            this.contentStats = { total, pending, approved, avgScore };
          },

          getTypeLabel(type) {
            const labels = {
              'blog': 'Blog',
              'linkedin': 'LinkedIn',
              'twitter': 'Twitter/X',
              'instagram': 'Instagram',
              'facebook_ad': 'FB Ad',
              'google_ad': 'Google Ad',
              'video_script': 'Video'
            };
            return labels[type] || type;
          },

          formatDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { 
              month: 'short', 
              day: 'numeric',
              hour: '2-digit',
              minute: '2-digit'
            });
          },

          viewContent(item) {
            this.selectedContent = item;
            this.showContentModal = true;
          },

          async copyContent(item) {
            try {
              await navigator.clipboard.writeText(item.content);
              alert('Content copied to clipboard!');
            } catch (error) {
              console.error('Failed to copy:', error);
            }
          },

          async approveContent(contentId) {
            try {
              await fetch(`/api/content/${contentId}/status`, {
                method: 'PATCH',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ status: 'approved' })
              });
              const item = this.allContent.find(c => c.contentId === contentId);
              if (item) item.status = 'approved';
              this.filterContent();
              this.updateContentStats();
            } catch (error) {
              console.error('Error approving content:', error);
            }
          },

          async rejectContent(contentId) {
            try {
              await fetch(`/api/content/${contentId}/status`, {
                method: 'PATCH',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ status: 'rejected' })
              });
              const item = this.allContent.find(c => c.contentId === contentId);
              if (item) item.status = 'rejected';
              this.filterContent();
              this.updateContentStats();
            } catch (error) {
              console.error('Error rejecting content:', error);
            }
          },

          async generateVideo(contentId) {
            if (this.isGeneratingVideo || !contentId) return;
            
            this.isGeneratingVideo = true;
            
            try {
              const response = await fetch(`/api/content/${contentId}/generate-video`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
              });
              
              const data = await response.json();
              
              if (response.ok && data.success) {
                if (data.videoUrl) {
                  // Update the selected content with the new video URL
                  this.selectedContent.videoUrl = data.videoUrl;
                  
                  // Also update in allContent
                  const item = this.allContent.find(c => c.contentId === contentId);
                  if (item) item.videoUrl = data.videoUrl;
                  
                  alert('Video generated successfully! You can now play it.');
                } else if (data.status === 'processing') {
                  alert('Video is being generated. This may take a few minutes. Refresh the page to check status.');
                }
              } else {
                alert('Failed to generate video: ' + (data.error || 'Unknown error'));
              }
            } catch (error) {
              console.error('Error generating video:', error);
              alert('Failed to generate video. Please try again.');
            } finally {
              this.isGeneratingVideo = false;
            }
          },

          // Video Projects Methods
          async loadVideoProjects() {
            try {
              const response = await fetch('/api/video-projects');
              const data = await response.json();
              this.allVideoProjects = data.map(project => ({
                ...project,
                totalScenes: 0,
                scenesReady: 0
              }));
              this.filterVideoProjects();
              this.updateVideoProjectStats();
            } catch (error) {
              console.error('Error loading video projects:', error);
            }
          },

          filterVideoProjects() {
            this.filteredVideoProjects = this.allVideoProjects.filter(project => {
              if (this.videoProjectFilter.status && project.status !== this.videoProjectFilter.status) return false;
              return true;
            });
          },

          updateVideoProjectStats() {
            const total = this.allVideoProjects.length;
            const draft = this.allVideoProjects.filter(p => p.status === 'draft').length;
            const generating = this.allVideoProjects.filter(p => p.status === 'generating').length;
            const ready = this.allVideoProjects.filter(p => p.status === 'ready').length;
            const exported = this.allVideoProjects.filter(p => p.status === 'exported').length;
            
            this.videoProjectStats = { total, draft, generating, ready, exported };
          },

          async viewVideoProject(project) {
            try {
              const response = await fetch(`/api/video-projects/${project.projectId}`);
              const data = await response.json();
              this.selectedVideoProject = data;
              this.showVideoProjectModal = true;
            } catch (error) {
              console.error('Error loading video project:', error);
              alert('Failed to load project details.');
            }
          },

          async startVideoGeneration(projectId) {
            if (this.isGeneratingProject || !projectId) return;
            
            this.isGeneratingProject = true;
            
            try {
              const response = await fetch(`/api/video-projects/${projectId}/generate`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ provider: 'wan' })
              });
              
              const data = await response.json();
              
              if (response.ok && data.success) {
                alert('Video generation started! This may take several minutes. Refresh the page to check progress.');
                
                // Update local status
                const project = this.allVideoProjects.find(p => p.projectId === projectId);
                if (project) project.status = 'generating';
                this.filterVideoProjects();
                this.updateVideoProjectStats();
              } else {
                alert('Failed to start generation: ' + (data.error || 'Unknown error'));
              }
            } catch (error) {
              console.error('Error starting video generation:', error);
              alert('Failed to start generation. Please try again.');
            } finally {
              this.isGeneratingProject = false;
            }
          },

          async exportVideoProject(projectId) {
            if (this.isExportingProject || !projectId) return;
            
            this.isExportingProject = true;
            
            try {
              const response = await fetch(`/api/video-projects/${projectId}/export`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
              });
              
              const data = await response.json();
              
              if (response.ok && data.success) {
                alert('Export started! The video will be assembled and ready for download shortly.');
                
                // Update local status
                const project = this.allVideoProjects.find(p => p.projectId === projectId);
                if (project) project.status = 'exporting';
                this.filterVideoProjects();
              } else {
                alert('Failed to export: ' + (data.error || 'Unknown error'));
              }
            } catch (error) {
              console.error('Error exporting video:', error);
              alert('Failed to export video. Please try again.');
            } finally {
              this.isExportingProject = false;
            }
          },

          async createVideoProject(contentId) {
            try {
              const response = await fetch('/api/video-projects', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ contentId })
              });
              
              const data = await response.json();
              
              if (response.ok) {
                alert('Video project created! Go to Video Projects to start generation.');
                await this.loadVideoProjects();
              } else {
                alert('Failed to create project: ' + (data.error || 'Unknown error'));
              }
            } catch (error) {
              console.error('Error creating video project:', error);
              alert('Failed to create project. Please try again.');
            }
          }
        }
      }
    </script>
    
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>

    <style>
      [x-cloak] { display: none !important; }
      
      body {
        font-family: 'Inter', sans-serif;
        background-color: #050505;
        color: #e5e5e5;
      }
      
      /* Cyberpunk scrollbar */
      ::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }
      ::-webkit-scrollbar-track {
        background: #0a0a0a;
      }
      ::-webkit-scrollbar-thumb {
        background: #333;
        border-radius: 3px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #00f3ff;
      }

      .neon-text-purple {
        text-shadow: 0 0 10px rgba(176, 38, 255, 0.5);
      }
      .neon-text-teal {
        text-shadow: 0 0 10px rgba(0, 243, 255, 0.5);
      }
      .neon-border-purple {
        box-shadow: 0 0 5px rgba(176, 38, 255, 0.3);
      }
    </style>
  </head>
  <body x-data="dashboard()" x-init="initDashboard()" class="antialiased min-h-screen flex flex-col overflow-x-hidden selection:bg-teal-500 selection:text-black">
    
    <!-- Header -->
    <header class="border-b border-white/10 bg-black/50 backdrop-blur-md sticky top-0 z-50">
      <div class="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
        <div class="flex items-center gap-6">
          <h1 class="text-xl md:text-2xl font-bold tracking-tight text-white">
            EMERGE <span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-teal-400">CONTROL TOWER</span>
          </h1>
          <nav class="hidden md:flex items-center gap-1">
            <button 
              @click="currentView = 'dashboard'" 
              :class="currentView === 'dashboard' ? 'bg-white/10 text-white' : 'text-zinc-500 hover:text-white'"
              class="px-3 py-1.5 rounded-lg text-sm font-medium transition-colors"
              data-testid="nav-dashboard"
            >Dashboard</button>
            <button 
              @click="currentView = 'content'; loadContent()" 
              :class="currentView === 'content' ? 'bg-white/10 text-white' : 'text-zinc-500 hover:text-white'"
              class="px-3 py-1.5 rounded-lg text-sm font-medium transition-colors"
              data-testid="nav-content-library"
            >Content Library</button>
            <button 
              @click="currentView = 'video-projects'; loadVideoProjects()" 
              :class="currentView === 'video-projects' ? 'bg-white/10 text-white' : 'text-zinc-500 hover:text-white'"
              class="px-3 py-1.5 rounded-lg text-sm font-medium transition-colors"
              data-testid="nav-video-projects"
            >Video Projects</button>
          </nav>
        </div>
        
        <div class="flex items-center gap-6">
          <!-- Content Factory Quick Action -->
          <div class="hidden lg:flex items-center gap-2" x-show="clients.length > 0">
            <select 
              x-model="selectedClient" 
              data-testid="select-client"
              class="bg-zinc-900 border border-white/10 rounded-lg px-3 py-1.5 text-sm text-white focus:border-purple-500 focus:ring-1 focus:ring-purple-500 outline-none"
            >
              <option value="">Select Client</option>
              <template x-for="client in clients" :key="client.id">
                <option :value="client.id" x-text="client.name"></option>
              </template>
            </select>
            <button 
              @click="runWeekForClient()"
              :disabled="!selectedClient || isRunning"
              data-testid="button-run-week"
              class="flex items-center gap-2 px-4 py-1.5 bg-gradient-to-r from-purple-600 to-teal-500 rounded-lg text-sm font-medium text-white hover:from-purple-500 hover:to-teal-400 transition-all disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <svg x-show="!isRunning" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
              <svg x-show="isRunning" class="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
              <span x-text="isRunning ? 'Generating...' : 'Run Week'"></span>
            </button>
          </div>
          
          <div class="hidden md:flex flex-col items-end">
            <div class="text-sm font-mono text-teal-400" x-text="time"></div>
            <div class="text-xs text-zinc-500 uppercase tracking-wider">Dubai Standard Time</div>
          </div>
          
          <div class="flex items-center gap-3 pl-6 border-l border-white/10">
            <div class="relative">
              <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="Founder" class="w-9 h-9 rounded-full ring-2 ring-white/10 bg-zinc-800">
              <div class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-black"></div>
            </div>
            <div class="hidden sm:block">
              <div class="text-xs font-medium text-white">System Status</div>
              <div class="text-[10px] text-green-400 font-mono uppercase tracking-wide">All Systems Green</div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <main class="flex-1 max-w-7xl w-full mx-auto px-4 py-8 space-y-8">
      
      <!-- Dashboard View -->
      <div x-show="currentView === 'dashboard'" x-cloak>
      
      <!-- Hero KPI Row -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <!-- Total MRR -->
        <div class="bg-zinc-900/50 border border-white/5 rounded-xl p-5 hover:border-purple-500/50 transition-colors group relative overflow-hidden">
          <div class="absolute inset-0 bg-gradient-to-br from-purple-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
          <div class="flex justify-between items-start mb-2">
            <h3 class="text-zinc-500 text-xs uppercase tracking-wider font-semibold">Total MRR</h3>
            <span class="text-green-400 text-xs font-mono flex items-center gap-1">
              <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
              <span x-text="kpi.mrrChange"></span>
            </span>
          </div>
          <div class="text-3xl font-bold text-white tracking-tight mb-1" x-text="kpi.mrr"></div>
          <div class="text-xs text-zinc-600">Monthly Recurring Revenue</div>
        </div>

        <!-- Profit Today -->
        <div class="bg-zinc-900/50 border border-white/5 rounded-xl p-5 hover:border-teal-500/50 transition-colors group relative overflow-hidden">
          <div class="absolute inset-0 bg-gradient-to-br from-teal-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
          <div class="flex justify-between items-start mb-2">
            <h3 class="text-zinc-500 text-xs uppercase tracking-wider font-semibold">Profit Today</h3>
          </div>
          <div class="text-3xl font-bold text-white tracking-tight mb-1" x-text="kpi.profit"></div>
          <div class="text-xs text-zinc-600">Net profit after expenses</div>
        </div>

        <!-- Active Pods -->
        <div class="bg-zinc-900/50 border border-white/5 rounded-xl p-5 hover:border-blue-500/50 transition-colors group relative overflow-hidden">
           <div class="flex justify-between items-start mb-2">
            <h3 class="text-zinc-500 text-xs uppercase tracking-wider font-semibold">Active Pods</h3>
            <span class="h-2 w-2 rounded-full bg-green-500 animate-pulse"></span>
          </div>
          <div class="text-3xl font-bold text-white tracking-tight mb-1">3<span class="text-zinc-600 text-xl font-normal">/5</span></div>
          <div class="text-xs text-zinc-600">Operational capacity at 60%</div>
        </div>

        <!-- AI Output -->
        <div class="bg-zinc-900/50 border border-white/5 rounded-xl p-5 hover:border-pink-500/50 transition-colors group relative overflow-hidden">
           <div class="flex justify-between items-start mb-2">
            <h3 class="text-zinc-500 text-xs uppercase tracking-wider font-semibold">AI Output</h3>
          </div>
          <div class="text-3xl font-bold text-white tracking-tight mb-1" x-text="kpi.aiOutput"></div>
          <div class="text-xs text-zinc-600">Pieces generated today</div>
        </div>
      </div>

      <!-- Pod Health Cards -->
      <div>
        <h2 class="text-sm font-semibold text-zinc-400 mb-4 uppercase tracking-wider flex items-center gap-2">
          <span class="w-1.5 h-1.5 rounded-full bg-purple-500"></span> Pod Health
        </h2>
        <div class="overflow-x-auto pb-4 -mx-4 px-4 md:overflow-visible md:pb-0 md:mx-0 md:px-0">
            <div class="flex md:grid md:grid-cols-3 gap-4 w-max md:w-full">
                <template x-for="pod in pods" :key="pod.name">
                    <div class="w-72 md:w-auto bg-black border border-white/10 rounded-lg p-4 shrink-0 flex flex-col gap-3 hover:border-white/20 transition-colors">
                        <div class="flex justify-between items-center">
                            <div>
                                <div class="font-bold text-white" x-text="pod.name"></div>
                                <div class="text-xs text-zinc-500" x-text="pod.vertical"></div>
                            </div>
                            <div class="relative w-10 h-10 flex items-center justify-center">
                                <svg class="w-full h-full transform -rotate-90">
                                    <circle cx="20" cy="20" r="16" stroke="#333" stroke-width="3" fill="none"></circle>
                                    <circle cx="20" cy="20" r="16" :stroke="getHealthColor(pod.health)" stroke-width="3" fill="none" stroke-dasharray="100" :stroke-dashoffset="100 - pod.health"></circle>
                                </svg>
                                <span class="absolute text-[10px] font-mono" x-text="pod.health"></span>
                            </div>
                        </div>
                        <div class="flex justify-between items-end mt-2">
                            <div>
                                <div class="text-[10px] text-zinc-500 uppercase">MRR</div>
                                <div class="text-sm font-mono text-white" x-text="pod.mrr"></div>
                            </div>
                             <div class="flex flex-col items-end w-1/2">
                                <div class="text-[10px] text-zinc-500 uppercase mb-1">Profit Margin</div>
                                <div class="h-1.5 w-full bg-zinc-800 rounded-full overflow-hidden">
                                    <div class="h-full bg-gradient-to-r from-purple-600 to-teal-400" :style="`width: ${pod.margin}%`"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
          
          <!-- Upcoming Phase Changes -->
          <div class="lg:col-span-1">
               <h2 class="text-sm font-semibold text-zinc-400 mb-4 uppercase tracking-wider flex items-center gap-2">
                <span class="w-1.5 h-1.5 rounded-full bg-teal-500"></span> Phase Changes
              </h2>
              <div class="space-y-3">
                  <template x-for="phase in phases" :key="phase.client">
                      <div class="bg-zinc-900/30 border-l-2 border-teal-500/50 pl-4 py-2">
                          <div class="flex justify-between items-center mb-1">
                              <span class="text-sm font-medium text-white" x-text="phase.client"></span>
                              <span class="text-xs font-mono text-teal-400" x-text="phase.countdown"></span>
                          </div>
                          <div class="flex items-center gap-2 text-xs text-zinc-500">
                              <span x-text="phase.oldPrice"></span>
                              <span class="text-zinc-700">→</span>
                              <span class="text-white font-medium" x-text="phase.newPrice"></span>
                          </div>
                          <div class="text-[10px] text-zinc-600 mt-1" x-text="phase.date"></div>
                      </div>
                  </template>
              </div>
          </div>

          <!-- Approval Queue -->
          <div class="lg:col-span-2">
               <h2 class="text-sm font-semibold text-zinc-400 mb-4 uppercase tracking-wider flex items-center gap-2">
                <span class="w-1.5 h-1.5 rounded-full bg-blue-500"></span> Approval Queue
              </h2>
              <div class="space-y-3">
                  <template x-for="item in queue" :key="item.id">
                      <div class="flex items-center gap-4 bg-zinc-900/50 border border-white/5 p-3 rounded-lg hover:bg-zinc-900 transition-colors">
                          <div class="w-12 h-12 bg-zinc-800 rounded overflow-hidden shrink-0 relative group cursor-pointer">
                              <img :src="item.thumbnail" class="w-full h-full object-cover opacity-70 group-hover:opacity-100 transition-opacity">
                              <div class="absolute inset-0 flex items-center justify-center bg-black/50 opacity-0 group-hover:opacity-100">
                                  <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                              </div>
                          </div>
                          <div class="flex-1 min-w-0">
                              <div class="flex items-center gap-2">
                                  <h4 class="text-sm font-medium text-white truncate" x-text="item.client"></h4>
                                  <span class="text-[10px] px-1.5 py-0.5 rounded bg-zinc-800 text-zinc-400" x-text="item.type"></span>
                              </div>
                              <p class="text-xs text-zinc-500 truncate mt-0.5">Submitted by <span x-text="item.author"></span> • <span x-text="item.timeAgo"></span></p>
                          </div>
                          <div class="flex items-center gap-2">
                               <button @click="approve(item.id)" class="p-2 rounded hover:bg-green-500/10 text-zinc-400 hover:text-green-400 transition-colors" title="Approve">
                                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                               </button>
                               <button @click="reject(item.id)" class="p-2 rounded hover:bg-red-500/10 text-zinc-400 hover:text-red-400 transition-colors" title="Reject">
                                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                               </button>
                          </div>
                      </div>
                  </template>
                  <div x-show="queue.length === 0" class="text-center py-8 text-zinc-600 text-sm">
                      All caught up! No items pending approval.
                  </div>
              </div>
          </div>
      </div>

      <!-- Red Flags -->
      <div class="bg-red-950/10 border border-red-900/20 rounded-xl p-6">
           <h2 class="text-sm font-semibold text-red-400 mb-4 uppercase tracking-wider flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                Critical Alerts
           </h2>
           <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
               <template x-for="alert in alerts" :key="alert.id">
                   <div class="flex gap-3 items-start">
                       <div class="w-1.5 h-1.5 rounded-full bg-red-500 mt-2 shrink-0"></div>
                       <div>
                           <div class="text-sm font-medium text-red-200" x-text="alert.title"></div>
                           <div class="text-xs text-red-500/70 mt-0.5" x-text="alert.desc"></div>
                       </div>
                   </div>
               </template>
           </div>
      </div>

      </div><!-- End Dashboard View -->

      <!-- Content Library View -->
      <div x-show="currentView === 'content'" x-cloak class="space-y-6">
        
        <!-- Header with Filters -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
          <div>
            <h2 class="text-2xl font-bold text-white">Content Library</h2>
            <p class="text-sm text-zinc-500 mt-1">Browse, approve, and manage all generated content</p>
          </div>
          
          <div class="flex items-center gap-3">
            <select 
              x-model="contentFilter.clientId" 
              @change="loadContent()"
              data-testid="filter-client"
              class="bg-zinc-900 border border-white/10 rounded-lg px-3 py-2 text-sm text-white focus:border-purple-500 focus:ring-1 focus:ring-purple-500 outline-none"
            >
              <option value="">All Clients</option>
              <template x-for="client in clients" :key="client.id">
                <option :value="client.id" x-text="client.name"></option>
              </template>
            </select>
            
            <select 
              x-model="contentFilter.type" 
              @change="filterContent()"
              data-testid="filter-type"
              class="bg-zinc-900 border border-white/10 rounded-lg px-3 py-2 text-sm text-white focus:border-purple-500 focus:ring-1 focus:ring-purple-500 outline-none"
            >
              <option value="">All Types</option>
              <option value="blog">Blog Posts</option>
              <option value="linkedin">LinkedIn</option>
              <option value="twitter">Twitter/X</option>
              <option value="instagram">Instagram</option>
              <option value="facebook_ad">Facebook Ads</option>
              <option value="google_ad">Google Ads</option>
              <option value="video_script">Video Scripts</option>
            </select>
            
            <select 
              x-model="contentFilter.status" 
              @change="filterContent()"
              data-testid="filter-status"
              class="bg-zinc-900 border border-white/10 rounded-lg px-3 py-2 text-sm text-white focus:border-purple-500 focus:ring-1 focus:ring-purple-500 outline-none"
            >
              <option value="">All Status</option>
              <option value="pending_review">Pending Review</option>
              <option value="approved">Approved</option>
              <option value="rejected">Rejected</option>
              <option value="draft">Draft</option>
            </select>
          </div>
        </div>

        <!-- Stats Bar -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
          <div class="bg-zinc-900/50 border border-white/5 rounded-lg p-4">
            <div class="text-2xl font-bold text-white" x-text="contentStats.total"></div>
            <div class="text-xs text-zinc-500">Total Pieces</div>
          </div>
          <div class="bg-zinc-900/50 border border-white/5 rounded-lg p-4">
            <div class="text-2xl font-bold text-yellow-400" x-text="contentStats.pending"></div>
            <div class="text-xs text-zinc-500">Pending Review</div>
          </div>
          <div class="bg-zinc-900/50 border border-white/5 rounded-lg p-4">
            <div class="text-2xl font-bold text-green-400" x-text="contentStats.approved"></div>
            <div class="text-xs text-zinc-500">Approved</div>
          </div>
          <div class="bg-zinc-900/50 border border-white/5 rounded-lg p-4">
            <div class="text-2xl font-bold text-purple-400" x-text="contentStats.avgScore"></div>
            <div class="text-xs text-zinc-500">Avg QA Score</div>
          </div>
        </div>

        <!-- Content Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <template x-for="item in filteredContent" :key="item.contentId">
            <div class="bg-zinc-900/50 border border-white/10 rounded-xl overflow-hidden hover:border-purple-500/50 transition-all group" :data-testid="'content-card-' + item.contentId">
              
              <!-- Card Header -->
              <div class="px-4 py-3 border-b border-white/5 flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <span class="text-xs px-2 py-0.5 rounded-full font-medium"
                    :class="{
                      'bg-blue-500/20 text-blue-400': item.type === 'blog',
                      'bg-sky-500/20 text-sky-400': item.type === 'linkedin',
                      'bg-zinc-500/20 text-zinc-400': item.type === 'twitter',
                      'bg-pink-500/20 text-pink-400': item.type === 'instagram',
                      'bg-indigo-500/20 text-indigo-400': item.type === 'facebook_ad',
                      'bg-yellow-500/20 text-yellow-400': item.type === 'google_ad',
                      'bg-red-500/20 text-red-400': item.type === 'video_script'
                    }"
                    x-text="getTypeLabel(item.type)"></span>
                  <span class="text-xs px-2 py-0.5 rounded-full"
                    :class="{
                      'bg-yellow-500/20 text-yellow-400': item.status === 'pending_review',
                      'bg-green-500/20 text-green-400': item.status === 'approved',
                      'bg-red-500/20 text-red-400': item.status === 'rejected',
                      'bg-zinc-500/20 text-zinc-400': item.status === 'draft'
                    }"
                    x-text="item.status.replace('_', ' ')"></span>
                </div>
                <div x-show="item.qaScore" class="flex items-center gap-1">
                  <svg class="w-3.5 h-3.5 text-teal-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                  <span class="text-xs font-mono text-teal-400" x-text="item.qaScore + '/10'"></span>
                </div>
              </div>
              
              <!-- Card Media Preview -->
              <div x-show="item.videoUrl || item.imageDataUrl" class="relative aspect-video bg-zinc-800">
                <!-- Video Preview -->
                <template x-if="item.videoUrl">
                  <div class="absolute inset-0 flex items-center justify-center cursor-pointer group/play" @click="viewContent(item)">
                    <video :src="item.videoUrl" class="w-full h-full object-cover" muted></video>
                    <div class="absolute inset-0 bg-black/40 flex items-center justify-center group-hover/play:bg-black/60 transition-colors">
                      <div class="w-12 h-12 rounded-full bg-white/20 flex items-center justify-center backdrop-blur-sm">
                        <svg class="w-6 h-6 text-white ml-1" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                      </div>
                    </div>
                  </div>
                </template>
                <!-- Image Preview -->
                <template x-if="!item.videoUrl && item.imageDataUrl">
                  <img :src="item.imageDataUrl" class="w-full h-full object-cover" alt="Generated image">
                </template>
              </div>
              
              <!-- Card Content -->
              <div class="p-4">
                <h3 class="font-medium text-white text-sm mb-2 line-clamp-2" x-text="item.title"></h3>
                <p class="text-xs text-zinc-500 line-clamp-4 leading-relaxed" x-text="item.content.substring(0, 200) + '...'"></p>
              </div>
              
              <!-- Card Footer -->
              <div class="px-4 py-3 border-t border-white/5 flex items-center justify-between">
                <span class="text-[10px] text-zinc-600" x-text="formatDate(item.createdAt)"></span>
                <div class="flex items-center gap-1">
                  <button 
                    @click="copyContent(item)" 
                    class="p-1.5 rounded hover:bg-white/5 text-zinc-500 hover:text-white transition-colors"
                    title="Copy to clipboard"
                    :data-testid="'copy-content-' + item.contentId"
                  >
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                  </button>
                  <button 
                    @click="viewContent(item)" 
                    class="p-1.5 rounded hover:bg-white/5 text-zinc-500 hover:text-white transition-colors"
                    title="View full content"
                    :data-testid="'view-content-' + item.contentId"
                  >
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                  </button>
                  <button 
                    @click="approveContent(item.contentId)" 
                    x-show="item.status === 'pending_review'"
                    class="p-1.5 rounded hover:bg-green-500/10 text-zinc-500 hover:text-green-400 transition-colors"
                    title="Approve"
                    :data-testid="'approve-content-' + item.contentId"
                  >
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                  </button>
                  <button 
                    @click="rejectContent(item.contentId)" 
                    x-show="item.status === 'pending_review'"
                    class="p-1.5 rounded hover:bg-red-500/10 text-zinc-500 hover:text-red-400 transition-colors"
                    title="Reject"
                    :data-testid="'reject-content-' + item.contentId"
                  >
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                  </button>
                  <button 
                    @click="createVideoProject(item.contentId)" 
                    x-show="item.type === 'video_script'"
                    class="p-1.5 rounded hover:bg-purple-500/10 text-zinc-500 hover:text-purple-400 transition-colors"
                    title="Create Video Project"
                    :data-testid="'create-project-' + item.contentId"
                  >
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                  </button>
                </div>
              </div>
            </div>
          </template>
          
          <!-- Empty State -->
          <div x-show="filteredContent.length === 0" class="col-span-full text-center py-16">
            <svg class="w-16 h-16 mx-auto text-zinc-700 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
            <h3 class="text-lg font-medium text-zinc-400 mb-2">No content found</h3>
            <p class="text-sm text-zinc-600">Generate some content using the "Run Week" button above.</p>
          </div>
        </div>
      </div><!-- End Content Library View -->

      <!-- Video Projects View -->
      <div x-show="currentView === 'video-projects'" x-cloak class="space-y-6">
        
        <!-- Header -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
          <div>
            <h2 class="text-2xl font-bold text-white">Video Projects</h2>
            <p class="text-sm text-zinc-500 mt-1">Generate full-length videos from script content using AI</p>
          </div>
          
          <div class="flex items-center gap-3">
            <select 
              x-model="videoProjectFilter.status" 
              @change="filterVideoProjects()"
              data-testid="filter-project-status"
              class="bg-zinc-900 border border-white/10 rounded-lg px-3 py-2 text-sm text-white focus:border-purple-500 focus:ring-1 focus:ring-purple-500 outline-none"
            >
              <option value="">All Status</option>
              <option value="draft">Draft</option>
              <option value="generating">Generating</option>
              <option value="ready">Ready</option>
              <option value="exported">Exported</option>
              <option value="failed">Failed</option>
            </select>
          </div>
        </div>

        <!-- Stats Bar -->
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
          <div class="bg-zinc-900/50 border border-white/5 rounded-lg p-4">
            <div class="text-2xl font-bold text-white" x-text="videoProjectStats.total"></div>
            <div class="text-xs text-zinc-500">Total Projects</div>
          </div>
          <div class="bg-zinc-900/50 border border-white/5 rounded-lg p-4">
            <div class="text-2xl font-bold text-zinc-400" x-text="videoProjectStats.draft"></div>
            <div class="text-xs text-zinc-500">Draft</div>
          </div>
          <div class="bg-zinc-900/50 border border-white/5 rounded-lg p-4">
            <div class="text-2xl font-bold text-yellow-400" x-text="videoProjectStats.generating"></div>
            <div class="text-xs text-zinc-500">Generating</div>
          </div>
          <div class="bg-zinc-900/50 border border-white/5 rounded-lg p-4">
            <div class="text-2xl font-bold text-green-400" x-text="videoProjectStats.ready"></div>
            <div class="text-xs text-zinc-500">Ready</div>
          </div>
          <div class="bg-zinc-900/50 border border-white/5 rounded-lg p-4">
            <div class="text-2xl font-bold text-purple-400" x-text="videoProjectStats.exported"></div>
            <div class="text-xs text-zinc-500">Exported</div>
          </div>
        </div>

        <!-- Projects Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" x-show="filteredVideoProjects && filteredVideoProjects.length > 0">
          <template x-for="project in (filteredVideoProjects || [])" :key="project.projectId">
            <div class="bg-zinc-900/50 border border-white/10 rounded-xl overflow-hidden hover:border-purple-500/50 transition-all group" :data-testid="'project-card-' + project.projectId">
              
              <!-- Card Header -->
              <div class="px-4 py-3 border-b border-white/5 flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <span class="text-xs px-2 py-0.5 rounded-full font-medium"
                    :class="{
                      'bg-zinc-500/20 text-zinc-400': project.status === 'draft',
                      'bg-yellow-500/20 text-yellow-400': project.status === 'generating',
                      'bg-green-500/20 text-green-400': project.status === 'ready',
                      'bg-purple-500/20 text-purple-400': project.status === 'exported',
                      'bg-red-500/20 text-red-400': project.status === 'failed'
                    }"
                    x-text="project.status"></span>
                </div>
                <div class="flex items-center gap-1 text-xs text-zinc-500">
                  <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                  <span x-text="project.totalDuration + 's'"></span>
                </div>
              </div>
              
              <!-- Card Content -->
              <div class="p-4">
                <h3 class="font-medium text-white mb-2 line-clamp-2" x-text="project.title"></h3>
                <p class="text-xs text-zinc-500 line-clamp-2" x-text="project.description"></p>
                
                <!-- Progress bar for generating status -->
                <div x-show="project.status === 'generating'" class="mt-4">
                  <div class="flex items-center justify-between text-xs text-zinc-400 mb-1">
                    <span>Generating scenes...</span>
                    <span x-text="project.scenesReady + '/' + project.totalScenes"></span>
                  </div>
                  <div class="h-1.5 bg-zinc-800 rounded-full overflow-hidden">
                    <div class="h-full bg-gradient-to-r from-purple-600 to-teal-400 transition-all duration-500" 
                         :style="'width: ' + (project.totalScenes > 0 ? (project.scenesReady / project.totalScenes * 100) : 0) + '%'"></div>
                  </div>
                </div>

                <!-- Scene preview for ready projects -->
                <div x-show="project.status === 'ready' || project.status === 'exported'" class="mt-4">
                  <div class="text-xs text-zinc-400 mb-2" x-text="project.totalScenes + ' scenes'"></div>
                </div>
              </div>
              
              <!-- Card Footer -->
              <div class="px-4 py-3 border-t border-white/5 flex items-center justify-between">
                <span class="text-xs text-zinc-500" x-text="formatDate(project.createdAt)"></span>
                <div class="flex items-center gap-2">
                  <button 
                    @click="viewVideoProject(project)"
                    class="p-2 rounded-lg hover:bg-white/5 text-zinc-400 hover:text-white transition-colors"
                    title="View Details"
                    :data-testid="'view-project-' + project.projectId"
                  >
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                  </button>
                  <button 
                    x-show="project.status === 'draft'"
                    @click="startVideoGeneration(project.projectId)"
                    :disabled="isGeneratingProject"
                    class="flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-gradient-to-r from-purple-600 to-teal-500 text-white text-xs font-medium hover:from-purple-500 hover:to-teal-400 transition-all disabled:opacity-50"
                    :data-testid="'generate-project-' + project.projectId"
                  >
                    <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                    Generate
                  </button>
                  <button 
                    x-show="project.status === 'ready'"
                    @click="exportVideoProject(project.projectId)"
                    :disabled="isExportingProject"
                    class="flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-gradient-to-r from-green-600 to-emerald-500 text-white text-xs font-medium hover:from-green-500 hover:to-emerald-400 transition-all disabled:opacity-50"
                    :data-testid="'export-project-' + project.projectId"
                  >
                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                    Export
                  </button>
                  <a 
                    x-show="project.status === 'exported' && project.outputUrl"
                    :href="project.outputUrl"
                    target="_blank"
                    class="flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-teal-600 text-white text-xs font-medium hover:bg-teal-500 transition-all"
                    :data-testid="'download-project-' + project.projectId"
                  >
                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                    Download
                  </a>
                </div>
              </div>
            </div>
            </template>
        </div>
        
        <!-- Empty State -->
        <div class="text-center py-16" x-show="!filteredVideoProjects || filteredVideoProjects.length === 0">
            <svg class="w-16 h-16 mx-auto text-zinc-700 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
            <h3 class="text-lg font-medium text-zinc-400 mb-2">No video projects yet</h3>
            <p class="text-sm text-zinc-600">Create a video project from a video script in the Content Library.</p>
        </div>
      </div><!-- End Video Projects View -->

      <!-- Video Project Detail Modal -->
      <div x-show="showVideoProjectModal" x-cloak 
           class="fixed inset-0 z-50 flex items-center justify-center p-4"
           @click.self="showVideoProjectModal = false">
        <div class="fixed inset-0 bg-black/80 backdrop-blur-sm"></div>
        <div class="relative bg-zinc-900 border border-white/10 rounded-xl max-w-4xl w-full max-h-[85vh] overflow-hidden">
          <div class="px-6 py-4 border-b border-white/10 flex items-center justify-between">
            <div>
              <h3 class="text-lg font-medium text-white" x-text="selectedVideoProject?.project?.title"></h3>
              <div class="flex items-center gap-3 mt-1">
                <span class="text-xs px-2 py-0.5 rounded-full"
                  :class="{
                    'bg-zinc-500/20 text-zinc-400': selectedVideoProject?.project?.status === 'draft',
                    'bg-yellow-500/20 text-yellow-400': selectedVideoProject?.project?.status === 'generating',
                    'bg-green-500/20 text-green-400': selectedVideoProject?.project?.status === 'ready',
                    'bg-purple-500/20 text-purple-400': selectedVideoProject?.project?.status === 'exported',
                    'bg-red-500/20 text-red-400': selectedVideoProject?.project?.status === 'failed'
                  }"
                  x-text="selectedVideoProject?.project?.status"></span>
                <span class="text-xs text-zinc-500" x-text="selectedVideoProject?.project?.totalDuration + 's total duration'"></span>
              </div>
            </div>
            <button @click="showVideoProjectModal = false" class="p-2 rounded-lg hover:bg-white/5 text-zinc-400 hover:text-white transition-colors">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
          </div>
          
          <div class="p-6 overflow-y-auto max-h-[60vh]">
            <!-- Scenes List -->
            <h4 class="text-sm font-semibold text-zinc-400 uppercase tracking-wider mb-4">Scenes</h4>
            <div class="space-y-3">
              <template x-for="scene in selectedVideoProject?.scenes" :key="scene.sceneId">
                <div class="bg-black/30 border border-white/5 rounded-lg p-4">
                  <div class="flex items-start justify-between mb-2">
                    <div class="flex items-center gap-2">
                      <span class="text-xs font-mono text-purple-400" x-text="'Scene ' + scene.sceneNumber"></span>
                      <span class="text-xs px-2 py-0.5 rounded-full"
                        :class="{
                          'bg-zinc-500/20 text-zinc-400': scene.status === 'pending',
                          'bg-yellow-500/20 text-yellow-400': scene.status === 'generating',
                          'bg-green-500/20 text-green-400': scene.status === 'ready',
                          'bg-red-500/20 text-red-400': scene.status === 'failed'
                        }"
                        x-text="scene.status"></span>
                    </div>
                    <span class="text-xs text-zinc-500" x-text="scene.duration + 's'"></span>
                  </div>
                  <p class="text-sm text-zinc-300 mb-2" x-text="scene.title"></p>
                  <p class="text-xs text-zinc-500" x-text="scene.voiceoverText"></p>
                </div>
              </template>
            </div>

            <!-- Generated Clips -->
            <template x-if="selectedVideoProject?.clips?.length > 0">
              <div class="mt-6">
                <h4 class="text-sm font-semibold text-zinc-400 uppercase tracking-wider mb-4">Generated Clips</h4>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                  <template x-for="clip in selectedVideoProject?.clips" :key="clip.clipId">
                    <div class="relative aspect-video bg-zinc-800 rounded-lg overflow-hidden">
                      <template x-if="clip.videoUrl">
                        <video :src="clip.videoUrl" class="w-full h-full object-cover" muted controls></video>
                      </template>
                      <template x-if="!clip.videoUrl">
                        <div class="flex items-center justify-center h-full">
                          <span class="text-xs text-zinc-500" x-text="clip.status"></span>
                        </div>
                      </template>
                    </div>
                  </template>
                </div>
              </div>
            </template>
          </div>
          
          <div class="px-6 py-4 border-t border-white/10 flex items-center justify-end gap-3">
            <button 
              x-show="selectedVideoProject?.project?.status === 'draft'"
              @click="startVideoGeneration(selectedVideoProject?.project?.projectId); showVideoProjectModal = false"
              :disabled="isGeneratingProject"
              class="flex items-center gap-2 px-4 py-2 rounded-lg bg-gradient-to-r from-purple-600 to-teal-500 text-white hover:from-purple-500 hover:to-teal-400 transition-colors disabled:opacity-50"
            >
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
              Start Generation
            </button>
            <button 
              x-show="selectedVideoProject?.project?.status === 'ready'"
              @click="exportVideoProject(selectedVideoProject?.project?.projectId); showVideoProjectModal = false"
              :disabled="isExportingProject"
              class="flex items-center gap-2 px-4 py-2 rounded-lg bg-gradient-to-r from-green-600 to-emerald-500 text-white hover:from-green-500 hover:to-emerald-400 transition-colors disabled:opacity-50"
            >
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
              Export Final Video
            </button>
          </div>
        </div>
      </div>

      <!-- Content Preview Modal -->
      <div x-show="showContentModal" x-cloak 
           class="fixed inset-0 z-50 flex items-center justify-center p-4"
           @click.self="showContentModal = false">
        <div class="fixed inset-0 bg-black/80 backdrop-blur-sm"></div>
        <div class="relative bg-zinc-900 border border-white/10 rounded-xl max-w-2xl w-full max-h-[80vh] overflow-hidden">
          <div class="px-6 py-4 border-b border-white/10 flex items-center justify-between">
            <div>
              <h3 class="text-lg font-medium text-white" x-text="selectedContent?.title"></h3>
              <div class="flex items-center gap-2 mt-1">
                <span class="text-xs px-2 py-0.5 rounded-full bg-purple-500/20 text-purple-400" x-text="getTypeLabel(selectedContent?.type)"></span>
                <span class="text-xs text-zinc-500" x-text="formatDate(selectedContent?.createdAt)"></span>
              </div>
            </div>
            <button @click="showContentModal = false" class="p-2 rounded-lg hover:bg-white/5 text-zinc-400 hover:text-white transition-colors">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
          </div>
          <div class="p-6 overflow-y-auto max-h-[60vh]">
            <!-- Video Player -->
            <div x-show="selectedContent?.videoUrl" class="mb-6">
              <div class="relative aspect-video bg-black rounded-lg overflow-hidden">
                <video 
                  x-ref="videoPlayer"
                  :src="selectedContent?.videoUrl" 
                  controls 
                  class="w-full h-full"
                  data-testid="video-player"
                ></video>
              </div>
              <div class="flex items-center justify-between mt-2">
                <span class="text-xs text-zinc-500">Generated by Runway AI</span>
                <a 
                  :href="selectedContent?.videoUrl" 
                  download 
                  class="text-xs text-teal-400 hover:text-teal-300 flex items-center gap-1"
                  data-testid="download-video"
                >
                  <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                  Download Video
                </a>
              </div>
            </div>
            
            <!-- Image Display -->
            <div x-show="!selectedContent?.videoUrl && selectedContent?.imageDataUrl" class="mb-6">
              <div class="relative rounded-lg overflow-hidden bg-zinc-800">
                <img 
                  :src="selectedContent?.imageDataUrl" 
                  class="w-full max-h-96 object-contain"
                  alt="Generated image"
                  data-testid="content-image"
                >
              </div>
              <span class="text-xs text-zinc-500 mt-2 block">Generated by Gemini AI</span>
            </div>
            
            <!-- Text Content -->
            <div class="prose prose-invert prose-sm max-w-none">
              <pre class="whitespace-pre-wrap text-sm text-zinc-300 font-sans leading-relaxed" x-text="selectedContent?.content"></pre>
            </div>
          </div>
          <div class="px-6 py-4 border-t border-white/10 flex items-center justify-end gap-3">
            <button @click="copyContent(selectedContent)" class="flex items-center gap-2 px-4 py-2 rounded-lg bg-white/5 text-white hover:bg-white/10 transition-colors">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
              Copy Content
            </button>
            <button 
              x-show="selectedContent?.type === 'video_script' && !selectedContent?.videoUrl"
              @click="generateVideo(selectedContent?.contentId)"
              :disabled="isGeneratingVideo"
              class="flex items-center gap-2 px-4 py-2 rounded-lg bg-gradient-to-r from-purple-600 to-pink-500 text-white hover:from-purple-500 hover:to-pink-400 transition-colors disabled:opacity-50"
              data-testid="button-generate-video"
            >
              <svg x-show="!isGeneratingVideo" class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
              <svg x-show="isGeneratingVideo" class="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
              <span x-text="isGeneratingVideo ? 'Generating Video...' : 'Generate Video'"></span>
            </button>
            <button 
              x-show="selectedContent?.status === 'pending_review'"
              @click="approveContent(selectedContent?.contentId); showContentModal = false" 
              class="flex items-center gap-2 px-4 py-2 rounded-lg bg-green-600 text-white hover:bg-green-500 transition-colors"
            >
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
              Approve
            </button>
          </div>
        </div>
      </div>

    </main>

    <footer class="border-t border-white/5 py-6 mt-auto">
        <div class="max-w-7xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center gap-4 text-xs text-zinc-600">
            <div>Emerge Digital © 2026</div>
            <div class="font-mono">Built on Replit • v2.4.0-alpha</div>
        </div>
    </footer>
  </body>
</html>